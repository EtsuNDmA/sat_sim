function [R,B,nB] = mfcalc( x,y,z,a,d,N,I,type )
%UNTITLED2 Summary of this function goes here
%   Detailed explanation goes here
mu0=1.25663706e-6;
n=1;
for k=1:length(z)
	for j=1:length(y)
		for i=1:length(x)
			X=x(i);Y=y(j);Z=z(k);
			B(n,1)=(((a-Y)*(1/((a-X)^2+(Z+d/2)^2)/sqrt((a-Y)^2+(a-X)^2+(Z+d/2)^2)-...
				1/((a+X)^2+(Z+d/2)^2)/sqrt((a-Y)^2+(a+X)^2+(Z+d/2)^2))+...
				(a+Y)*(1/((a-X)^2+(Z+d/2)^2)/sqrt((a+Y)^2+(a-X)^2+(Z+d/2)^2)-...
				1/((a+X)^2+(Z+d/2)^2)/sqrt((a+Y)^2+(a+X)^2+(Z+d/2)^2)))*(Z+d/2)+...
				((a-Y)*(1/((a-X)^2+(Z-d/2)^2)/sqrt((a-Y)^2+(a-X)^2+(Z-d/2)^2)-...
				1/((a+X)^2+(Z-d/2)^2)/sqrt((a-Y)^2+(a+X)^2+(Z-d/2)^2))+...
				(a+Y)*(1/((a-X)^2+(Z-d/2)^2)/sqrt((a+Y)^2+(a-X)^2+(Z-d/2)^2)-...
				1/((a+X)^2+(Z-d/2)^2)/sqrt((a+Y)^2+(a+X)^2+(Z-d/2)^2)))*(Z-d/2))*mu0*N*I/4/pi;
			B(n,2)=(((a-X)*(1/((a-Y)^2+(Z+d/2)^2)/sqrt((a-Y)^2+(a-X)^2+(Z+d/2)^2)-...
				1/((a+Y)^2+(Z+d/2)^2)/sqrt((a+Y)^2+(a-X)^2+(Z+d/2)^2))+...
				(a+X)*(1/((a-Y)^2+(Z+d/2)^2)/sqrt((a+X)^2+(a-Y)^2+(Z+d/2)^2)-...
				1/((a+Y)^2+(Z+d/2)^2)/sqrt((a+X)^2+(a+Y)^2+(Z+d/2)^2)))*(Z+d/2)+...
				((a-X)*(1/((a-Y)^2+(Z+d/2)^2)/sqrt((a-Y)^2+(a-X)^2+(Z+d/2)^2)-...
				1/((a+Y)^2+(Z+d/2)^2)/sqrt((a+Y)^2+(a-X)^2+(Z+d/2)^2))+...
				(a+X)*(1/((a-Y)^2+(Z+d/2)^2)/sqrt((a+X)^2+(a-Y)^2+(Z+d/2)^2)-...
				1/((a+Y)^2+(Z+d/2)^2)/sqrt((a+X)^2+(a+Y)^2+(Z+d/2)^2)))*(Z-d/2))*mu0*N*I/4/pi;
			B(n,3)=((a-X)*(a-Y)/sqrt((a-Y)^2+(a-X)^2+(Z+d/2)^2)*(1/((a-X)^2+(Z+d/2)^2)+1/((a-Y)^2+(Z+d/2)^2))+...
				(a-X)*(a+Y)/sqrt((a+Y)^2+(a-X)^2+(Z+d/2)^2)*(1/((a-X)^2+(Z+d/2)^2)+1/((a+Y)^2+(Z+d/2)^2))+...
				(a+X)*(a-Y)/sqrt((a-Y)^2+(a+X)^2+(Z+d/2)^2)*(1/((a+X)^2+(Z+d/2)^2)+1/((a-Y)^2+(Z+d/2)^2))+...
				(a+X)*(a+Y)/sqrt((a+Y)^2+(a+X)^2+(Z+d/2)^2)*(1/((a+X)^2+(Z+d/2)^2)+1/((a+Y)^2+(Z+d/2)^2))+...
				(a-X)*(a-Y)/sqrt((a-Y)^2+(a-X)^2+(Z-d/2)^2)*(1/((a-X)^2+(Z-d/2)^2)+1/((a-Y)^2+(Z-d/2)^2))+...
				(a-X)*(a+Y)/sqrt((a+Y)^2+(a-X)^2+(Z-d/2)^2)*(1/((a-X)^2+(Z-d/2)^2)+1/((a+Y)^2+(Z-d/2)^2))+...
				(a+X)*(a-Y)/sqrt((a-Y)^2+(a+X)^2+(Z-d/2)^2)*(1/((a+X)^2+(Z-d/2)^2)+1/((a-Y)^2+(Z-d/2)^2))+...
				(a+X)*(a+Y)/sqrt((a+Y)^2+(a+X)^2+(Z-d/2)^2)*(1/((a+X)^2+(Z-d/2)^2)+1/((a+Y)^2+(Z-d/2)^2)))*mu0*N*I/4/pi;
			R(n,1:3)=[X Y Z];
			nB(i,j,k)=norm(B(n,:));
				n=n+1
		end
	end
end

end

